<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org"
  th:replace="~{layout(titulo='Dashboard', content=~{::content}, pageScripts=~{::pageScripts})}">

<body>
  <div th:fragment="content">
    <div class="page-header">
      <div class="page-title">
        <h4>Dashboard do Tesoureiro</h4>
        <h6>Visão geral e consolidada das finanças</h6>
      </div>
    </div>

    <!-- Cards de Resumo -->
    <div class="row">
      <div class="col-xl-3 col-sm-6 col-12">
        <div class="card">
          <div class="card-body">
            <div class="dash-widget-header">
              <span class="dash-widget-icon bg-1">
                <i class="fas fa-users"></i>
              </span>
              <div class="dash-count">
                <h4 th:text="${dashboard.totalSocios}">0</h4>
              </div>
            </div>
            <div class="dash-widget-info">
              <h6>Total de Sócios</h6>
            </div>
          </div>
        </div>
      </div>
      <div class="col-xl-3 col-sm-6 col-12">
        <div class="card">
          <div class="card-body">
            <div class="dash-widget-header">
              <span class="dash-widget-icon bg-2">
                <i class="fas fa-user-check"></i>
              </span>
              <div class="dash-count">
                <h4 th:text="${dashboard.sociosFrequentes}">0</h4>
              </div>
            </div>
            <div class="dash-widget-info">
              <h6>Sócios Frequentes</h6>
            </div>
          </div>
        </div>
      </div>
      <div class="col-xl-3 col-sm-6 col-12">
        <div class="card">
          <div class="card-body">
            <div class="dash-widget-header">
              <span class="dash-widget-icon bg-3">
                <i class="fas fa-exclamation-triangle"></i>
              </span>
              <div class="dash-count">
                <h4 th:text="${dashboard.totalInadimplentes}">0</h4>
              </div>
            </div>
            <div class="dash-widget-info">
              <h6>Inadimplentes</h6>
            </div>
          </div>
        </div>
      </div>
      <div class="col-xl-3 col-sm-6 col-12">
        <div class="card">
          <div class="card-body">
            <div class="dash-widget-header">
              <span class="dash-widget-icon bg-4">
                <i class="fas fa-money-bill-wave"></i>
              </span>
              <div class="dash-count">
                <h4 th:text="${#numbers.formatCurrency(dashboard.totalAReceber)}">R$ 0,00</h4>
              </div>
            </div>
            <div class="dash-widget-info">
              <h6>Valores a Receber</h6>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Gráficos -->
    <div class="row">
      <div class="col-12 col-lg-6 col-xl-4 d-flex">
        <div class="card flex-fill">
          <div class="card-header">
            <div class="card-title mb-0">Distribuição de Sócios por Status</div>
          </div>
          <div class="card-body">
            <canvas id="graficoFrequenciaSocios" width="400" height="400"></canvas>
          </div>
        </div>
      </div>
      
      <div class="col-12 col-lg-6 col-xl-4 d-flex">
        <div class="card flex-fill">
          <div class="card-header">
            <div class="card-title mb-0">Adimplência vs Inadimplência</div>
          </div>
          <div class="card-body">
            <canvas id="graficoInadimplencias" width="400" height="400"></canvas>
          </div>
        </div>
      </div>
      
      <div class="col-12 col-lg-12 col-xl-4 d-flex">
        <div class="card flex-fill">
          <div class="card-header">
            <div class="card-title mb-0">Saldos Mensais</div>
          </div>
          <div class="card-body">
            <canvas id="graficoSaldos" width="400" height="400"></canvas>
          </div>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-12 col-lg-6 d-flex">
        <div class="card flex-fill">
          <div class="card-header">
            <div class="card-title mb-0">Entradas Mensais</div>
          </div>
          <div class="card-body">
            <canvas id="graficoEntradas" width="400" height="200"></canvas>
          </div>
        </div>
      </div>
      
      <div class="col-12 col-lg-6 d-flex">
        <div class="card flex-fill">
          <div class="card-header">
            <div class="card-title mb-0">Saídas Mensais</div>
          </div>
          <div class="card-body">
            <canvas id="graficoSaidas" width="400" height="200"></canvas>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div th:fragment="pageScripts">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script th:inline="javascript">
      /*<![CDATA[*/
      document.addEventListener('DOMContentLoaded', function() {
        // Dados do dashboard passados do controller
        const dashboardData = /*[[${dashboard}]]*/ {};
        
        // Cores para os gráficos
        const cores = {
          verde: 'rgba(40, 167, 69, 0.6)',
          vermelho: 'rgba(220, 53, 69, 0.6)',
          azul: 'rgba(0, 123, 255, 0.6)',
          amarelo: 'rgba(255, 193, 7, 0.6)',
          verdeBorda: 'rgba(40, 167, 69, 1)',
          vermelhoBorda: 'rgba(220, 53, 69, 1)',
          azulBorda: 'rgba(0, 123, 255, 1)',
          amareloBorda: 'rgba(255, 193, 7, 1)'
        };
        
        // Gráfico de Frequência de Sócios
        const ctxFrequencia = document.getElementById('graficoFrequenciaSocios').getContext('2d');
        new Chart(ctxFrequencia, {
          type: 'doughnut',
          data: {
            labels: ['Frequentes', 'Não Frequentes'],
            datasets: [{
              data: [dashboardData.sociosFrequentes, dashboardData.sociosNaoFrequentes],
              backgroundColor: [cores.verde, cores.amarelo],
              borderColor: [cores.verdeBorda, cores.amareloBorda],
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false
          }
        });
        
        // Gráfico de Inadimplências
        const ctxInadimplencias = document.getElementById('graficoInadimplencias').getContext('2d');
        const adimplentes = dashboardData.totalSocios - dashboardData.totalInadimplentes;
        new Chart(ctxInadimplencias, {
          type: 'doughnut',
          data: {
            labels: ['Adimplentes', 'Inadimplentes'],
            datasets: [{
              data: [adimplentes, dashboardData.totalInadimplentes],
              backgroundColor: [cores.verde, cores.vermelho],
              borderColor: [cores.verdeBorda, cores.vermelhoBorda],
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false
          }
        });
        
        // Gráfico de Saldos
        const ctxSaldos = document.getElementById('graficoSaldos').getContext('2d');
        new Chart(ctxSaldos, {
          type: 'line',
          data: {
            labels: dashboardData.saldosMensais.map(item => item.label),
            datasets: [{
              label: 'Saldos (R$)',
              data: dashboardData.saldosMensais.map(item => item.valor),
              backgroundColor: cores.azul,
              borderColor: cores.azulBorda,
              borderWidth: 2,
              fill: true
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              y: {
                beginAtZero: true
              }
            }
          }
        });
        
        // Gráfico de Entradas
        const ctxEntradas = document.getElementById('graficoEntradas').getContext('2d');
        new Chart(ctxEntradas, {
          type: 'bar',
          data: {
            labels: dashboardData.entradasMensais.map(item => item.label),
            datasets: [{
              label: 'Entradas (R$)',
              data: dashboardData.entradasMensais.map(item => item.valor),
              backgroundColor: cores.verde,
              borderColor: cores.verdeBorda,
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              y: {
                beginAtZero: true
              }
            }
          }
        });
        
        // Gráfico de Saídas
        const ctxSaidas = document.getElementById('graficoSaidas').getContext('2d');
        new Chart(ctxSaidas, {
          type: 'bar',
          data: {
            labels: dashboardData.saidasMensais.map(item => item.label),
            datasets: [{
              label: 'Saídas (R$)',
              data: dashboardData.saidasMensais.map(item => item.valor),
              backgroundColor: cores.vermelho,
              borderColor: cores.vermelhoBorda,
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              y: {
                beginAtZero: true
              }
            }
          }
        });
      });
      /*]]>*/
    </script>
  </div>
</body>

</html>
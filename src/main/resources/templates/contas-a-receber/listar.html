<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:replace="~{layout(titulo='Contas a Receber', content=~{::content}, pageScripts=~{::pageScripts}, pageStyles=~{::pageStyles})}">
<head>
    <title>Contas a Receber</title>
</head>
<body>
<div th:fragment="content">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="mb-0">Contas a Receber</h1>
        <a th:href="@{/contas-a-receber/nova}" class="btn btn-primary">Nova Conta a Receber</a>
    </div>

    <div class="card">
        <div class="card-body">
            <div class="table-responsive">
                <table id="contasReceberTable" class="table table-striped table-hover" th:if="${not #lists.isEmpty(contas)}">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Pagador</th>
                            <th>Descrição</th>
                            <th>Rubrica</th>
                            <th>Vencimento</th>
                            <th>Valor</th>
                            <th>Status</th>
                            <th>Ações</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="conta : ${contas}">
                            <td th:text="${conta.id}"></td>
                            <td th:text="${conta.pagador}"></td>
                            <td th:text="${conta.descricao}"></td>
                            <td th:text="${conta.rubrica?.nome}"></td>
                            <td th:text="${#temporals.format(conta.dataVencimento, 'dd/MM/yyyy')}"></td>
                            <td th:text="${#numbers.formatCurrency(conta.valor)}"></td>
                            <td>
                                <span th:classappend="${conta.status.name() == 'PAGA' ? 'badge-light-success' : 'badge-light-danger'}" 
                                      class="badge" 
                                      th:text="${conta.status.descricao}"></span>
                            </td>
                            <td>
                                <a th:if="${conta.status.name() == 'ABERTA'}" th:href="@{/cobrancas/pagar/{id}(id=${conta.id})}" class="btn btn-sm btn-success">Dar Baixa</a>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <div th:if="${#lists.isEmpty(contas)}" class="alert alert-info" role="alert">
                    <strong>Nenhuma conta a receber encontrada.</strong> Clique no botão "Nova Conta a Receber" para criar uma nova.
                </div>
            </div>
        </div>
    </div>
</div>

<th:block th:fragment="pageStyles">
    <link rel="stylesheet" th:href="@{/assets/plugins/datatables/buttons.dataTables.min.css}" />
</th:block>

<th:block th:fragment="pageScripts">
    <script th:src="@{/assets/plugins/datatables/dataTables.buttons.min.js}"></script>
    <script th:src="@{/assets/plugins/datatables/buttons.print.min.js}"></script>
    <script>
        $(document).ready(function() {
            $('#contasReceberTable').DataTable({
                "language": {
                    "url": "//cdn.datatables.net/plug-ins/1.10.25/i18n/Portuguese-Brasil.json"
                },
                dom: 'Bfrtip', // Add buttons to the DOM
                buttons: [
                    'print' // Enable print button
                ]
            });
        });
    </script>
</th:block>
</body>
</html>
<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd"
    name="grupos_rubrica_report" pageWidth="595" pageHeight="842" columnWidth="555"
    leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20">

    <property name="com.jaspersoft.studio.data.defaultdataadapter" value="One Empty Record" />

    <!-- Parâmetros do cabeçalho -->
    <parameter name="INSTITUICAO_NOME" class="java.lang.String" />
    <parameter name="INSTITUICAO_ENDERECO" class="java.lang.String" />
    <parameter name="INSTITUICAO_LOGO" class="java.io.InputStream" />
    <parameter name="DATA_GERACAO" class="java.lang.String" />

    <!-- Parâmetros específicos do relatório -->
    <parameter name="MES" class="java.lang.Integer" />
    <parameter name="ANO" class="java.lang.Integer" />
    <parameter name="SALDO_PERIODO_ANTERIOR" class="java.math.BigDecimal" />
    <parameter name="TOTAL_ENTRADAS" class="java.math.BigDecimal" />
    <parameter name="TOTAL_SAIDAS" class="java.math.BigDecimal" />
    <parameter name="SALDO_OPERACIONAL" class="java.math.BigDecimal" />
    <parameter name="SALDO_FINAL_CAIXA_BANCO" class="java.math.BigDecimal" />

    <!-- Parâmetros para dados agrupados -->
    <parameter name="ENTRADAS_AGRUPADAS"
        class="net.sf.jasperreports.engine.data.JRBeanCollectionDataSource" />
    <parameter name="SAIDAS_AGRUPADAS"
        class="net.sf.jasperreports.engine.data.JRBeanCollectionDataSource" />

    <!-- Parâmetros para sub-relatórios -->
    <parameter name="RUBRICA_AGRUPADA_SUBREPORT" class="net.sf.jasperreports.engine.JasperReport" />

    <queryString>
        <![CDATA[]]>
    </queryString>

    <field name="id" class="java.lang.Long" />
    <field name="nome" class="java.lang.String" />

    <title>
        <band height="160" splitType="Stretch">
            <!-- Cabeçalho com logotipo e informações da instituição -->
            <image>
                <reportElement x="0" y="0" width="80" height="80" />
                <imageExpression><![CDATA[$P{INSTITUICAO_LOGO}]]></imageExpression>
            </image>

            <textField isStretchWithOverflow="true">
                <reportElement x="90" y="5" width="465" height="25" />
                <textElement verticalAlignment="Middle">
                    <font size="18" isBold="true" isUnderline="true" />
                </textElement>
                <textFieldExpression><![CDATA[$P{INSTITUICAO_NOME}]]></textFieldExpression>
            </textField>

            <textField>
                <reportElement x="90" y="35" width="465" height="20" />
                <textElement verticalAlignment="Middle">
                    <font size="12" />
                </textElement>
                <textFieldExpression><![CDATA[$P{INSTITUICAO_ENDERECO}]]></textFieldExpression>
            </textField>

            <!-- Data de geração -->
            <textField>
                <reportElement x="400" y="60" width="155" height="15" />
                <textElement textAlignment="Right" verticalAlignment="Middle">
                    <font size="10" />
                </textElement>
                <textFieldExpression><![CDATA["Gerado em: " + $P{DATA_GERACAO}]]></textFieldExpression>
            </textField>

            <!-- Linha separadora -->
            <line>
                <reportElement x="0" y="85" width="555" height="1" />
                <graphicElement>
                    <pen lineWidth="2.0" lineColor="#000000" />
                </graphicElement>
            </line>

            <!-- Título do relatório -->
            <staticText>
                <reportElement x="0" y="95" width="555" height="25" />
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font size="16" isBold="true" />
                </textElement>
                <text><![CDATA[DEMONSTRATIVO FINANCEIRO MENSAL POR GRUPOS E RUBRICAS]]></text>
            </staticText>

            <!-- Período do relatório -->
            <textField>
                <reportElement x="0" y="125" width="555" height="20" />
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font size="14" isBold="true" />
                </textElement>
                <textFieldExpression><![CDATA["Período: " + 
                    (($P{MES} == 1) ? "Janeiro" : 
                     ($P{MES} == 2) ? "Fevereiro" : 
                     ($P{MES} == 3) ? "Março" : 
                     ($P{MES} == 4) ? "Abril" : 
                     ($P{MES} == 5) ? "Maio" : 
                     ($P{MES} == 6) ? "Junho" : 
                     ($P{MES} == 7) ? "Julho" : 
                     ($P{MES} == 8) ? "Agosto" : 
                     ($P{MES} == 9) ? "Setembro" : 
                     ($P{MES} == 10) ? "Outubro" : 
                     ($P{MES} == 11) ? "Novembro" : "Dezembro") + 
                    " de " + $P{ANO}]]></textFieldExpression>
            </textField>
        </band>
    </title>

    <pageHeader>
        <band height="50" splitType="Stretch">
            <!-- Resumo financeiro -->
            <rectangle>
                <reportElement x="0" y="0" width="555" height="45" backcolor="#F0F0F0" />
                <graphicElement>
                    <pen lineWidth="1.0" lineColor="#CCCCCC" />
                </graphicElement>
            </rectangle>

            <staticText>
                <reportElement x="10" y="5" width="120" height="15" />
                <textElement verticalAlignment="Middle">
                    <font size="10" isBold="true" />
                </textElement>
                <text><![CDATA[Saldo Período Anterior:]]></text>
            </staticText>

            <textField pattern="¤#,##0.00;¤-#,##0.00">
                <reportElement x="130" y="5" width="100" height="15" />
                <textElement verticalAlignment="Middle">
                    <font size="10" />
                </textElement>
                <textFieldExpression><![CDATA[$P{SALDO_PERIODO_ANTERIOR}]]></textFieldExpression>
            </textField>

            <staticText>
                <reportElement x="250" y="5" width="80" height="15" />
                <textElement verticalAlignment="Middle">
                    <font size="10" isBold="true" />
                </textElement>
                <text><![CDATA[Total Entradas:]]></text>
            </staticText>

            <textField pattern="¤#,##0.00;¤-#,##0.00">
                <reportElement x="330" y="5" width="100" height="15" />
                <textElement verticalAlignment="Middle">
                    <font size="10" forecolor="#006600" />
                </textElement>
                <textFieldExpression><![CDATA[$P{TOTAL_ENTRADAS}]]></textFieldExpression>
            </textField>

            <staticText>
                <reportElement x="10" y="25" width="80" height="15" />
                <textElement verticalAlignment="Middle">
                    <font size="10" isBold="true" />
                </textElement>
                <text><![CDATA[Total Saídas:]]></text>
            </staticText>

            <textField pattern="¤#,##0.00;¤-#,##0.00">
                <reportElement x="90" y="25" width="100" height="15" />
                <textElement verticalAlignment="Middle">
                    <font size="10" forecolor="#CC0000" />
                </textElement>
                <textFieldExpression><![CDATA[$P{TOTAL_SAIDAS}]]></textFieldExpression>
            </textField>

            <staticText>
                <reportElement x="210" y="25" width="100" height="15" />
                <textElement verticalAlignment="Middle">
                    <font size="10" isBold="true" />
                </textElement>
                <text><![CDATA[Saldo Operacional:]]></text>
            </staticText>

            <textField pattern="¤#,##0.00;¤-#,##0.00">
                <reportElement x="310" y="25" width="100" height="15" />
                <textElement verticalAlignment="Middle">
                    <font size="10" isBold="true" />
                </textElement>
                <textFieldExpression><![CDATA[$P{SALDO_OPERACIONAL}]]></textFieldExpression>
            </textField>

            <staticText>
                <reportElement x="430" y="25" width="80" height="15" />
                <textElement verticalAlignment="Middle">
                    <font size="10" isBold="true" />
                </textElement>
                <text><![CDATA[Saldo Final:]]></text>
            </staticText>

            <textField pattern="¤#,##0.00;¤-#,##0.00">
                <reportElement x="510" y="25" width="100" height="15" />
                <textElement verticalAlignment="Middle">
                    <font size="10" isBold="true" isUnderline="true" />
                </textElement>
                <textFieldExpression><![CDATA[$P{SALDO_FINAL_CAIXA_BANCO}]]></textFieldExpression>
            </textField>
        </band>
    </pageHeader>

    <detail>
        <band height="100" splitType="Stretch">
            <!-- Seção de Entradas -->
            <staticText>
                <reportElement x="0" y="10" width="555" height="20" />
                <textElement textAlignment="Left" verticalAlignment="Middle">
                    <font size="14" isBold="true" forecolor="#006600" />
                </textElement>
                <text><![CDATA[ENTRADAS POR GRUPOS E RUBRICAS]]></text>
            </staticText>

            <line>
                <reportElement x="0" y="30" width="555" height="1" />
                <graphicElement>
                    <pen lineWidth="1.0" lineColor="#006600" />
                </graphicElement>
            </line>

            <!-- Sub-relatório para entradas agrupadas -->
            <subreport>
                <reportElement x="0" y="35" width="555" height="60" isRemoveLineWhenBlank="true" />
                <dataSourceExpression><![CDATA[$P{ENTRADAS_AGRUPADAS}]]></dataSourceExpression>
                <subreportExpression><![CDATA[$P{RUBRICA_AGRUPADA_SUBREPORT}]]></subreportExpression>
            </subreport>
        </band>
    </detail>

    <summary>
        <band height="100" splitType="Stretch">
            <!-- Seção de Saídas -->
            <staticText>
                <reportElement x="0" y="10" width="555" height="20" />
                <textElement textAlignment="Left" verticalAlignment="Middle">
                    <font size="14" isBold="true" forecolor="#CC0000" />
                </textElement>
                <text><![CDATA[SAÍDAS POR GRUPOS E RUBRICAS]]></text>
            </staticText>

            <line>
                <reportElement x="0" y="30" width="555" height="1" />
                <graphicElement>
                    <pen lineWidth="1.0" lineColor="#CC0000" />
                </graphicElement>
            </line>

            <!-- Sub-relatório para saídas agrupadas -->
            <subreport>
                <reportElement x="0" y="35" width="555" height="60" isRemoveLineWhenBlank="true" />
                <dataSourceExpression><![CDATA[$P{SAIDAS_AGRUPADAS}]]></dataSourceExpression>
                <subreportExpression><![CDATA[$P{RUBRICA_AGRUPADA_SUBREPORT}]]></subreportExpression>
            </subreport>
        </band>
    </summary>

    <pageFooter>
        <band height="30" splitType="Stretch">
            <line>
                <reportElement x="0" y="5" width="555" height="1" />
                <graphicElement>
                    <pen lineWidth="1.0" lineColor="#CCCCCC" />
                </graphicElement>
            </line>

            <textField>
                <reportElement x="0" y="10" width="200" height="15" />
                <textElement verticalAlignment="Middle">
                    <font size="8" />
                </textElement>
                <textFieldExpression><![CDATA["Impresso em: " + new java.text.SimpleDateFormat("dd/MM/yyyy HH:mm").format(new java.util.Date())]]></textFieldExpression>
            </textField>

            <textField>
                <reportElement x="455" y="10" width="100" height="15" />
                <textElement textAlignment="Right" verticalAlignment="Middle">
                    <font size="8" />
                </textElement>
                <textFieldExpression><![CDATA["Página " + $V{PAGE_NUMBER} + " de " + $V{PAGE_COUNT}]]></textFieldExpression>
            </textField>
        </band>
    </pageFooter>
</jasperReport>